{% extends 'base.html' %}

{% block title %}Home ~ Anime Verse{% endblock %}

{% block content %}
<div class="home-page">
        <!--Hero section-->
    <div class="hero-section">
        {% if current_user.is_authenticated %}
            <h1>Welcome back, {{ current_user.name }}! </h1>
            <p class="hero-subtitle">Ready to discover your next favourite anime?</p>
        {% else %}
            <h1>Welcome to Anime Verse</h1>
            <p class="hero-subtitle">Track, Rate and Discover Amazing world of Anime</p>
        {% endif %}
    </div>

    <!-- New: Hero Carousel only if not searching-->
     {% if current_user.is_authenticated and not search_query %}
     <div class="hero-carousel-section">
        <div class="container">


            <!--Carousel container-->
            <div class="hero-carousel">

                <!--Carousel Track (holds all slides)-->
                <div class="carousel-track">

                    {% for anime in hero_anime %}
                    <!--Carousel slide-->
                    <div class="carousel-slide {% if loop.first %}active{% endif %} ">

                        <!--background Image-->
                        <div class="slide-background" style="background-image: url('{{ anime.images.jpg.large_image_url }}');"></div>

                        <!--Gradient overlay (make text readable)-->
                        <div class="slide-overlay"></div>

                        <!--Slide Content-->
                        <div class="slide-content">

                            <!--Anime title-->
                            <h2 class="slide-title">{{ anime.title }}</h2>

                            <!--Anime Metadata (genre, rating,)-->
                            <div class="slide-meta">

                                <!--Genres-->
                                {% if anime.genres %}
                                <span class="meta-genres">
                                    üëæ
                                    {% for genre in anime.genres[:3] %}
                                        {{ genre.name }}{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </span>
                                {% endif %}

                                <!--Rating-->
                                {% if anime.score %}
                                <span class="meta-rating">
                                    ‚ú® {{ anime.score }}/10
                                </span>
                                {% endif %}

                                <!--Status-->
                                {% if anime.status %}
                                <span class="meta-status">
                                    {{ anime.status }}
                                </span>
                                {% endif %}

                                <!--Year-->
                                {% if anime.year %}
                                <span class="meta-year">
                                    üìÖ {{ anime.year }}
                                </span>
                                {% endif %}

                            </div>

                            <!--Action Button-->
                            <div class="slide-actions">
                                <a href="{{ url_for('main.anime_details', anime_id=anime.mal_id) }}" class="btn btn-primary">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div> 
                    {% endfor %}
                </div>

                <!--Navigation Arrows-->
                <button class="carousel-arrow carousel-arrow-left" id="carousel-prev">
                    ‚Ü¢
                </button>

                <button class="carousel-arrow carousel-arrow-right" id="carousel-next">
                    ‚Ü£
                </button>

                <!--Slide Indicators (dots)-->
                <div class="carousel-indicators">
                    {% for anime in hero_anime %}
                    <button class="indicator {% if loop.first %}active{% endif %}" data-slide="{{ loop.index0 }}"></button>
                    {% endfor %}
                </div>
            </div>
        </div>
     </div>
     {% endif %}

    <!--Search Bar (for logged in users)-->

    {% if current_user.is_authenticated %}
        <div class="search-section">
            <form action="{{ url_for('main.index') }}" method="GET" class="search-form">
                <input type="text" name="q" placeholder="Search for Anime..."
                class="search-input" 
                value="{{ search_query }}"
                required autocomplete="off">

                <button type="submit" class="search-btn">Search</button>
            </form>
        </div>
    {% endif %}

    <!--for Not logged in users-->

    {% if not current_user.is_authenticated %}
    <div class="cta-section">
        <a href="{{ url_for('auth.register') }}" class="btn btn-primary btn-large">Get Started</a>

        <a href="{{ url_for('auth.login') }}" class="btn btn-secondary btn-large">Sign In</a>
    </div>
    {% endif %}

    <!--Search Results Section-->
    {% if search_query %}
    <div class="featured-section">
        <h2>
            Search Results for "{{ search_query }}"
        </h2>
        <p class="section-subtitle">
            Found {{ search_results|length }} results
        </p>

        {% if search_results %}
        <div class="anime-grid">
            {% for anime in search_results %}
            <div class="anime-card">
                <div class="anime-card-image">
                    <img src="{{ anime.images.jpg.large_image_url }}" alt="{{ anime.title }}" loading="lazy">
                </div>

                <div class="anime-card-content">
                    <h3 class="anime-title">{{ anime.title }}</h3>

                    <div class="anime-info">
                        <span class="anime-type">{{ anime.type }}</span>
                        {% if anime.episodes %}
                        <span class="anime-episodes">{{ anime.episodes }} eps</span>
                        {% endif %}
                    </div>

                    {% if anime.score %}
                    <div class="anime-rating">
                        <span class="rating-star">üåü</span>
                        <span class="rating-score">{{ anime.score }}</span>
                    </div>
                    {% endif %}

                    <div class="anime-actions">
                        <a href="{{ url_for('main.anime_details', 
                        anime_id=anime.mal_id,
                        from_search=search_query,
                        page=current_page) }}" class="btn btn-primary btn-small">View Details</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!--Pagination Controls-->
        <div class="pagination-controls">
            <!--Previous Page button-->
            {% if current_page > 1 %}
            <a href="{{ url_for('main.index', q=search_query, page=current_page - 1) }}" class="btn btn-secondary">
                ‚Üê Previous Page
            </a>
            {% endif %}

            <!--Page info-->
            <span class="page-info">Page {{ current_page }}</span>

            <!--Next Page button-->
            {% if has_next_page %}
            <a href="{{ url_for('main.index', q=search_query, page=current_page + 1) }}" class="btn btn-primary">
                 Next Page ‚Üí
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% else %}

    <!--Featured anime section(when no search)-->
    <div class="featured-section">
        <h2>Popular Anime</h2>
        <p class="section-subtitle">Treading anime everyone's watching</p>

        <div class="anime-grid">
            <!--Placeholder cards we'll populate with real data later-->
            <div class="anime-card">
                <div class="anime-card-placeholder">
                    <p>Loading Anime...</p>
                    <small>Coming soon via Jikan API</small>
                </div>
            </div>
            <div class="anime-card">
                <div class="anime-card-placeholder">
                    <p>Loading anime...</p>
                    <small>Coming Soon via Jikan API</small>
                </div>
            </div>
            <div class="anime-card">
                <div class="anime-card-placeholder">
                    <p>Loading Anime</p>
                    <small>Coming soon via Jikan API</small>
                </div>
            </div>
            <div class="anime-card">
                <div class="anime-card-placeholder">
                    <p>Loading anime</p>
                    <small>Coming Soon via Jikan API</small>
                </div>
            </div>
        </div>
    </div>
    {% endif %}


    <!--Features Section -->
    {% if not current_user.is_authenticated %}
    <div class="features-section">
        <h2 class="text-center mb-3" >Why Choose Anime Verse</h2>

        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">üéóÔ∏è</div>
                <h3>Track your Anime</h3>
                <p>Keep a personlized wathclist of anime you are watching, completed or going to watch...</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">üéóÔ∏è</div>
                <h3>Get Recommendations</h3>
                <p>Discover new anime based on your watch history and rating. Find your next anime watch..</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">üëæ</div>
                <h3>Powered By Jikan</h3>
                <p>Access comprehensive anime data from MyAnimeList through the Jikan API</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}